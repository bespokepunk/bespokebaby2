<!DOCTYPE html>
<html>
<head>
    <title>Test localStorage</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #0a0a0a; color: #0f0; }
        .test { margin: 10px 0; padding: 10px; background: #1a1a1a; border: 2px solid #00ff88; }
        .pass { border-color: #00ff88; }
        .fail { border-color: #ff0000; color: #ff0000; }
        button { padding: 10px 20px; margin: 5px; background: #00ff88; border: none; cursor: pointer; }
        input { padding: 10px; width: 300px; font-size: 14px; }
    </style>
</head>
<body>
    <h1>localStorage Test</h1>

    <div id="results"></div>

    <div class="test">
        <h3>Manual Test:</h3>
        <input type="text" id="testInput" placeholder="Type something here...">
        <button onclick="saveTest()">Save to localStorage</button>
        <button onclick="loadTest()">Load from localStorage</button>
        <button onclick="clearTest()">Clear localStorage</button>
        <div id="savedValue" style="margin-top: 10px;"></div>
    </div>

    <script>
        const results = document.getElementById('results');

        function addResult(test, passed, details) {
            const div = document.createElement('div');
            div.className = passed ? 'test pass' : 'test fail';
            div.innerHTML = `<strong>${test}:</strong> ${passed ? '✓ PASS' : '✗ FAIL'}<br>${details}`;
            results.appendChild(div);
        }

        // Test 1: localStorage available?
        try {
            const available = typeof(Storage) !== "undefined";
            addResult('localStorage Available', available, available ? 'localStorage is supported' : 'localStorage NOT supported');
        } catch(e) {
            addResult('localStorage Available', false, 'Error: ' + e.message);
        }

        // Test 2: Can we write?
        try {
            localStorage.setItem('test_key', 'test_value');
            addResult('localStorage Write', true, 'Successfully wrote to localStorage');
        } catch(e) {
            addResult('localStorage Write', false, 'Error: ' + e.message);
        }

        // Test 3: Can we read?
        try {
            const value = localStorage.getItem('test_key');
            const passed = value === 'test_value';
            addResult('localStorage Read', passed, `Read value: "${value}"`);
        } catch(e) {
            addResult('localStorage Read', false, 'Error: ' + e.message);
        }

        // Test 4: Can we store JSON?
        try {
            const testObj = { name: 'test', count: 123, items: ['a', 'b', 'c'] };
            localStorage.setItem('test_json', JSON.stringify(testObj));
            const retrieved = JSON.parse(localStorage.getItem('test_json'));
            const passed = retrieved.name === 'test' && retrieved.count === 123;
            addResult('localStorage JSON', passed, `Stored and retrieved: ${JSON.stringify(retrieved)}`);
        } catch(e) {
            addResult('localStorage JSON', false, 'Error: ' + e.message);
        }

        // Test 5: Check storage quota
        try {
            if (navigator.storage && navigator.storage.estimate) {
                navigator.storage.estimate().then(estimate => {
                    const used = estimate.usage;
                    const total = estimate.quota;
                    const percent = ((used / total) * 100).toFixed(2);
                    addResult('Storage Quota', true, `Using ${used} bytes of ${total} (${percent}%)`);
                });
            } else {
                addResult('Storage Quota', true, 'Quota API not available (but localStorage might still work)');
            }
        } catch(e) {
            addResult('Storage Quota', false, 'Error: ' + e.message);
        }

        // Test 6: List all localStorage keys
        try {
            const keys = Object.keys(localStorage);
            addResult('Existing Keys', true, `Found ${keys.length} keys: ${keys.join(', ') || '(none)'}`);
        } catch(e) {
            addResult('Existing Keys', false, 'Error: ' + e.message);
        }

        // Manual test functions
        function saveTest() {
            const value = document.getElementById('testInput').value;
            try {
                localStorage.setItem('manual_test', value);
                document.getElementById('savedValue').innerHTML = `<span style="color: #00ff88;">✓ Saved: "${value}"</span>`;
                console.log('Saved to localStorage:', value);
            } catch(e) {
                document.getElementById('savedValue').innerHTML = `<span style="color: #ff0000;">✗ Error: ${e.message}</span>`;
            }
        }

        function loadTest() {
            try {
                const value = localStorage.getItem('manual_test');
                document.getElementById('testInput').value = value || '';
                document.getElementById('savedValue').innerHTML = `<span style="color: #00ff88;">✓ Loaded: "${value || '(nothing)'}"</span>`;
                console.log('Loaded from localStorage:', value);
            } catch(e) {
                document.getElementById('savedValue').innerHTML = `<span style="color: #ff0000;">✗ Error: ${e.message}</span>`;
            }
        }

        function clearTest() {
            try {
                localStorage.clear();
                document.getElementById('savedValue').innerHTML = `<span style="color: #00ff88;">✓ Cleared all localStorage</span>`;
                console.log('Cleared localStorage');
            } catch(e) {
                document.getElementById('savedValue').innerHTML = `<span style="color: #ff0000;">✗ Error: ${e.message}</span>`;
            }
        }

        console.log('localStorage test page loaded');
        console.log('localStorage available:', typeof(Storage) !== "undefined");
        console.log('Current localStorage contents:', localStorage);
    </script>
</body>
</html>
