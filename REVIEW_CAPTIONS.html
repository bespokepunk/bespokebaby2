<!DOCTYPE html>
<html>
<head>
    <title>Review AI-Generated Captions</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #e0e0e0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #00ff88; }
        .grid { display: grid; grid-template-columns: 400px 1fr; gap: 20px; margin-bottom: 30px; }
        .image-panel { background: #2a2a2a; padding: 20px; border-radius: 8px; }
        .form-panel { background: #2a2a2a; padding: 20px; border-radius: 8px; }
        .punk-image { width: 350px; height: 350px; image-rendering: pixelated; border: 3px solid #444; }
        .filename { margin: 15px 0; color: #00ff88; font-weight: bold; }
        .caption-box { width: 100%; min-height: 120px; background: #1a1a1a; border: 2px solid #3a3a3a; color: #e0e0e0; padding: 10px; font-family: monospace; border-radius: 4px; margin: 10px 0; }
        .caption-box:focus { border-color: #00ff88; outline: none; }
        label { display: block; margin: 10px 0 5px 0; color: #00ff88; font-weight: bold; }
        .diff { background: #3a1a1a; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .old { color: #ff6b6b; }
        .new { color: #51cf66; }
        .buttons { display: flex; gap: 10px; margin-top: 20px; }
        button { padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-approve { background: #00ff88; color: #000; }
        .btn-edit { background: #4a9eff; color: #fff; }
        .btn-skip { background: #666; color: #fff; }
        .btn-prev { background: #444; color: #fff; }
        .progress { background: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .progress-bar { width: 100%; height: 25px; background: #1a1a1a; border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00ff88, #00cc66); transition: width 0.3s; }
        .stats { display: flex; gap: 15px; margin-top: 15px; }
        .stat { background: #1a1a1a; padding: 10px; border-radius: 4px; text-align: center; }
        .stat-num { font-size: 24px; color: #00ff88; font-weight: bold; }
        .stat-label { font-size: 11px; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Review AI-Generated Captions</h1>
            <p>Review and approve/edit AI-generated captions for each punk</p>
        </div>

        <div class="progress">
            <div>Progress: <strong id="current">1</strong> / <strong id="total">203</strong></div>
            <div class="progress-bar"><div class="progress-fill" id="progress" style="width: 0%"></div></div>
            <div class="stats">
                <div class="stat"><div class="stat-num" id="approved">0</div><div class="stat-label">Approved</div></div>
                <div class="stat"><div class="stat-num" id="edited">0</div><div class="stat-label">Edited</div></div>
                <div class="stat"><div class="stat-num" id="skipped">0</div><div class="stat-label">Skipped</div></div>
            </div>
        </div>

        <div class="grid">
            <div class="image-panel">
                <img id="punk-img" class="punk-image" src="" alt="Punk">
                <div class="filename" id="filename"></div>
                <div id="palette"></div>
            </div>

            <div class="form-panel">
                <h3 style="color: #00ff88;">Current Caption (OLD)</h3>
                <div class="caption-box old" id="old-caption"></div>

                <div class="diff" id="diff-view"></div>

                <h3 style="color: #00ff88;">AI-Generated Caption (NEW)</h3>
                <textarea class="caption-box new" id="new-caption"></textarea>

                <label>Your Final Caption (edit above or approve as-is)</label>

                <div class="buttons">
                    <button class="btn-prev" onclick="prev()">‚Üê Prev</button>
                    <button class="btn-skip" onclick="skip()">Skip</button>
                    <button class="btn-approve" onclick="approve()">‚úì Approve AI Caption</button>
                    <button class="btn-edit" onclick="saveEdit()">‚úì Save My Edit</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = [];
        let currentIndex = 0;
        let results = { approved: [], edited: [], skipped: [] };

        // Load data
        fetch('ai_generated_captions.json')
            .then(r => r.json())
            .then(d => {
                data = d;
                loadImage(0);
            });

        function loadImage(index) {
            if (index < 0 || index >= data.length) return;

            currentIndex = index;
            const item = data[index];

            document.getElementById('punk-img').src = `civitai_v2_7_training/${item.filename}`;
            document.getElementById('filename').textContent = item.filename;
            document.getElementById('old-caption').textContent = item.currentCaption;
            document.getElementById('new-caption').value = item.aiGeneratedCaption;

            // Show diff
            showDiff(item.currentCaption, item.aiGeneratedCaption);

            updateProgress();
        }

        function showDiff(old, ai) {
            const diffView = document.getElementById('diff-view');
            if (old === ai) {
                diffView.innerHTML = '<div style="color: #51cf66;">‚úì No changes (AI matches current)</div>';
            } else {
                diffView.innerHTML = '<div><strong>Changes:</strong> AI detected different colors/attributes</div>';
            }
        }

        function approve() {
            const item = data[currentIndex];
            item.userApproved = true;
            item.finalCaption = item.aiGeneratedCaption;
            results.approved.push(item);
            next();
        }

        function saveEdit() {
            const item = data[currentIndex];
            const edited = document.getElementById('new-caption').value;
            item.userApproved = true;
            item.finalCaption = edited;
            item.userEdits = edited;
            results.edited.push(item);
            next();
        }

        function skip() {
            results.skipped.push(data[currentIndex]);
            next();
        }

        function prev() {
            if (currentIndex > 0) loadImage(currentIndex - 1);
        }

        function next() {
            if (currentIndex < data.length - 1) {
                loadImage(currentIndex + 1);
            } else {
                alert('Done! Downloading results...');
                download();
            }
        }

        function updateProgress() {
            const percent = ((currentIndex + 1) / data.length) * 100;
            document.getElementById('progress').style.width = percent + '%';
            document.getElementById('current').textContent = currentIndex + 1;
            document.getElementById('total').textContent = data.length;
            document.getElementById('approved').textContent = results.approved.length;
            document.getElementById('edited').textContent = results.edited.length;
            document.getElementById('skipped').textContent = results.skipped.length;
        }

        function download() {
            const output = {
                approved: results.approved,
                edited: results.edited,
                skipped: results.skipped,
                summary: {
                    total: data.length,
                    approved: results.approved.length,
                    edited: results.edited.length,
                    skipped: results.skipped.length
                }
            };

            const blob = new Blob([JSON.stringify(output, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reviewed_captions.json';
            a.click();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') approve();
            if (e.key === 'ArrowLeft') prev();
            if (e.key === 's') skip();
        });
    </script>
</body>
</html>
