# Updated Supabase Review Interface

## What Changed

The interface now shows your **FINAL captions** (from the `.txt` files generated by `create_final_perfect_captions.py`) instead of the AI comprehensive captions.

### Display Changes:
- **ORIGINAL**: The original caption (unchanged)
- **FINAL**: The final caption from your `.txt` files (highlighted in yellow)
- **Edits/Feedback**: Your modifications to the final caption

## Setup (One-Time)

### 1. Update Supabase Database

Run this SQL in your Supabase SQL Editor:

```sql
ALTER TABLE caption_reviews
ADD COLUMN IF NOT EXISTS final_caption_txt TEXT;

COMMENT ON COLUMN caption_reviews.final_caption_txt IS 'The final caption from the .txt file (before any user edits)';
```

Or just run the file `add_final_caption_txt_column.sql` in Supabase.

### 2. Open the Interface

```bash
open SUPABASE_REVIEW.html
```

Or just double-click `SUPABASE_REVIEW.html`

## How It Works

1. **Loads Final Captions**: Reads all `.txt` files from `civitai_v2_7_training/`
2. **Shows Final Caption**: Displays the generated final caption (yellow text)
3. **Track Changes**:
   - **Approve (A)**: Accept final caption as-is
   - **Save Edit (E)**: Modify final caption with your feedback
   - **Skip (S)**: Skip for now

4. **Saves to Supabase**:
   - `final_caption_txt`: Original final caption from .txt file
   - `final_caption`: Final caption after your edits (or original if approved)
   - `user_corrections`: Your feedback/edits
   - `status`: approved/edited/skipped

## Benefits

✅ Review your actual training captions
✅ All edits sync to Supabase cloud
✅ Track which captions need adjustments
✅ Export feedback for regeneration
✅ Never lose progress

## Usage

1. Open `SUPABASE_REVIEW.html`
2. Review each image's final caption
3. Either:
   - Press **A** to approve
   - Type feedback and press **E** to save edits
   - Press **S** to skip
4. All changes save to Supabase automatically

## Exporting Data

When you're done reviewing, you can export all your edits:

```sql
-- Run in Supabase SQL Editor to export all edited captions
SELECT filename, final_caption_txt, user_corrections, final_caption
FROM caption_reviews
WHERE status = 'edited'
ORDER BY updated_at DESC;
```

Or export as JSON for regeneration scripts.
